<nb-card>
  <nb-card-header>
    <div class="header-row">
      <h5>
        <nb-icon icon="credit-card-outline"></nb-icon>
        Kredi Ayarları
      </h5>
      <span class="saved-badge" *ngIf="saved">
        <nb-icon icon="checkmark-circle-2-outline"></nb-icon>
        Kaydedildi!
      </span>
    </div>
  </nb-card-header>
  <nb-card-body>
    <!-- Loading -->
    <div *ngIf="loading" class="loading-state">
      <nb-spinner status="primary"></nb-spinner>
      <p>Yükleniyor...</p>
    </div>

    <!-- Error -->
    <div *ngIf="error && !loading" class="error-state">
      <nb-icon icon="alert-triangle-outline" status="danger"></nb-icon>
      <span>{{ error }}</span>
      <button nbButton ghost size="small" (click)="loadSettings()">Tekrar Dene</button>
    </div>

    <!-- Form -->
    <div *ngIf="!loading && !error" class="settings-form">
      
      <!-- Aktif/Pasif Toggle -->
      <div class="form-group toggle-row">
        <div class="label-section">
          <label>Kredi Satışı</label>
          <span class="hint">Kredi satışını açıp kapatabilirsiniz</span>
        </div>
        <nb-toggle 
          [(ngModel)]="settings.isActive"
          [status]="settings.isActive ? 'success' : 'basic'"
        >
          {{ settings.isActive ? 'Aktif' : 'Pasif' }}
        </nb-toggle>
      </div>

      <!-- Fiyat -->
      <div class="form-group">
        <label>
          <nb-icon icon="pricetags-outline"></nb-icon>
          Kredi Başına Fiyat (TL)
        </label>
        <div class="price-input-wrapper">
          <input 
            nbInput 
            fullWidth 
            type="number"
            step="0.01"
            min="0"
            [(ngModel)]="priceInTL"
            placeholder="1.00"
          >
          <span class="currency">₺</span>
        </div>
        <span class="hint">1 kredi = {{ priceInTL | number:'1.2-2' }} TL ({{ settings.pricePerCredit }} kuruş)</span>
      </div>

      <!-- Min Purchase -->
      <div class="form-group">
        <label>
          <nb-icon icon="trending-down-outline"></nb-icon>
          Minimum Satın Alma
        </label>
        <input 
          nbInput 
          fullWidth 
          type="number"
          min="1"
          [(ngModel)]="settings.minPurchase"
          placeholder="1"
        >
        <span class="hint">Kullanıcının tek seferde satın alabileceği minimum kredi sayısı</span>
      </div>

      <!-- Max Purchase -->
      <div class="form-group">
        <label>
          <nb-icon icon="trending-up-outline"></nb-icon>
          Maksimum Satın Alma
        </label>
        <input 
          nbInput 
          fullWidth 
          type="number"
          min="1"
          [(ngModel)]="settings.maxPurchase"
          placeholder="1000"
        >
        <span class="hint">Kullanıcının tek seferde satın alabileceği maksimum kredi sayısı</span>
      </div>

      <!-- Price Calculator -->
      <div class="price-calculator">
        <h6>
          <nb-icon icon="pie-chart-outline"></nb-icon>
          Fiyat Hesaplayıcı
        </h6>
        <div class="calc-grid">
          <div class="calc-item">
            <span class="amount">10 Kredi</span>
            <span class="price">{{ (10 * priceInTL) | number:'1.2-2' }} ₺</span>
          </div>
          <div class="calc-item">
            <span class="amount">50 Kredi</span>
            <span class="price">{{ (50 * priceInTL) | number:'1.2-2' }} ₺</span>
          </div>
          <div class="calc-item">
            <span class="amount">100 Kredi</span>
            <span class="price">{{ (100 * priceInTL) | number:'1.2-2' }} ₺</span>
          </div>
          <div class="calc-item">
            <span class="amount">500 Kredi</span>
            <span class="price">{{ (500 * priceInTL) | number:'1.2-2' }} ₺</span>
          </div>
        </div>
      </div>

      <!-- Son Güncelleme -->
      <div class="last-updated" *ngIf="settings.updatedAt">
        <nb-icon icon="clock-outline"></nb-icon>
        Son güncelleme: {{ settings.updatedAt | date:'dd/MM/yyyy HH:mm' }}
      </div>
    </div>
  </nb-card-body>
  <nb-card-footer *ngIf="!loading && !error">
    <button nbButton status="primary" [disabled]="saving" (click)="saveSettings()">
      <nb-icon icon="save-outline" *ngIf="!saving"></nb-icon>
      <nb-spinner *ngIf="saving" size="tiny" status="control"></nb-spinner>
      {{ saving ? 'Kaydediliyor...' : 'Değişiklikleri Kaydet' }}
    </button>
  </nb-card-footer>
</nb-card>
